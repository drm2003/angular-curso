{"ast":null,"code":"import { FormGroup, FormControl, Validators } from '@angular/forms';\nimport { HttpClient, HttpResponseBase, HttpErrorResponse } from '@angular/common/http';\nimport { map, catchError } from 'rxjs/operators';\nimport { Router } from '@angular/router';\nimport { User } from '../../models/user';\nimport { PageDataService } from '../../services/page-data.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"../../services/page-data.service\";\nimport * as i4 from \"../../components/header/header.component\";\nimport * as i5 from \"@angular/forms\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"../../components/cmail-form-group/cmail-form-group.component\";\nimport * as i8 from \"../../components/cmail-form-group/cmail-form-fiel.directive\";\n\nfunction CadastroComponent_ul_6_li_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\", 10);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const erro_r7 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\" \", erro_r7.message, \": \", erro_r7.value, \" \");\n  }\n}\n\nfunction CadastroComponent_ul_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ul\", 16);\n    i0.ɵɵtemplate(1, CadastroComponent_ul_6_li_1_Template, 2, 2, \"li\", 17);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.mensagensErro);\n  }\n}\n\nfunction CadastroComponent_div_9_span_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 10);\n    i0.ɵɵtext(1, \"Informar um nome \\u00E9 obrigat\\u00F3rio\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction CadastroComponent_div_9_span_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 10);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r9 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\" Voc\\u00EA preencheu \", ctx_r9.formCadastro.get(\"nome\").errors.minlength.actualLength, \" caracteres de \", ctx_r9.formCadastro.get(\"nome\").errors.minlength.requiredLength, \" \");\n  }\n}\n\nfunction CadastroComponent_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtemplate(1, CadastroComponent_div_9_span_1_Template, 2, 0, \"span\", 18);\n    i0.ɵɵtemplate(2, CadastroComponent_div_9_span_2_Template, 2, 2, \"span\", 18);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.formCadastro.get(\"nome\").errors.required);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.formCadastro.get(\"nome\").errors.minlength);\n  }\n}\n\nfunction CadastroComponent_div_20_span_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 10);\n    i0.ɵɵtext(1, \"Informar um nome \\u00E9 obrigat\\u00F3rio\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction CadastroComponent_div_20_span_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 10);\n    i0.ɵɵtext(1, \" O telefone deve ter entre 8 e 9 caracteres \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction CadastroComponent_div_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtemplate(1, CadastroComponent_div_20_span_1_Template, 2, 0, \"span\", 18);\n    i0.ɵɵtemplate(2, CadastroComponent_div_20_span_2_Template, 2, 0, \"span\", 18);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.formCadastro.get(\"telefone\").errors.required);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.formCadastro.get(\"telefone\").errors.pattern);\n  }\n}\n\nfunction CadastroComponent_div_23_span_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 10);\n    i0.ɵɵtext(1, \"Informar uma url com um avatar obrigat\\u00F3rio\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction CadastroComponent_div_23_span_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 10);\n    i0.ɵɵtext(1, \"Erro na URL informada :(\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction CadastroComponent_div_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtemplate(1, CadastroComponent_div_23_span_1_Template, 2, 0, \"span\", 18);\n    i0.ɵɵtemplate(2, CadastroComponent_div_23_span_2_Template, 2, 0, \"span\", 18);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.formCadastro.get(\"avatar\").hasError(\"required\"));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.formCadastro.get(\"avatar\").hasError(\"urlInvalida\"));\n  }\n}\n\nfunction CadastroComponent_span_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵelement(1, \"img\", 19);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate(\"src\", ctx_r4.formCadastro.get(\"avatar\").value, i0.ɵɵsanitizeUrl);\n  }\n}\n\nfunction CadastroComponent_span_26_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \" Valida\\u00E7\\u00E3o pendente.... \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nexport let CadastroComponent = /*#__PURE__*/(() => {\n  class CadastroComponent {\n    constructor(httpClient, roteador, pageService) {\n      this.httpClient = httpClient;\n      this.roteador = roteador;\n      this.pageService = pageService;\n      this.formCadastro = new FormGroup({\n        nome: new FormControl('', [Validators.required, Validators.minLength(3)]),\n        username: new FormControl('', [Validators.required]),\n        senha: new FormControl('', [Validators.required]),\n        telefone: new FormControl('', [Validators.required, Validators.pattern('\\\\d{4,5}-?\\\\d{4}')]),\n        avatar: new FormControl('', Validators.required, this.validaImagem.bind(this))\n      });\n    }\n\n    ngOnInit() {\n      this.pageService.defineTitulo('Cadastro de Usuários - CMail');\n    }\n\n    handleCadastrarUsuario() {\n      if (this.formCadastro.valid) {\n        const userData = new User(this.formCadastro.value);\n        this.httpClient.post('http://localhost:3200/users', userData).subscribe(() => {\n          console.log(`Cadastrado com sucesso.`);\n          this.mensagensErro = [];\n          this.formCadastro.reset(); // após 1 segundo faz o redirecionamento da rota para login\n\n          setTimeout(() => {\n            this.roteador.navigate[''];\n          }, 1000);\n        }, responseError => {\n          //resposta caso existam erros!\n          this.mensagensErro = responseError.error.body;\n        });\n      } else {\n        this.validarTodosOsCamposDoFormulario();\n      }\n    }\n\n    validarTodosOsCamposDoFormulario() {\n      const form = this.formCadastro;\n      /* Object.keys(form.controls).forEach(field =>{\n        const control = form.get(field);\n        control.markAsTouched({ onlySelf: true })\n      }); */\n\n      form.markAllAsTouched();\n    }\n\n    validaImagem(campoDoFormulario) {\n      /* return new Promise(resolve => resolve()); */\n      return this.httpClient.head(campoDoFormulario.value, {\n        observe: 'response'\n      }).pipe(map(response => {\n        return response.ok ? null : {\n          urlInvalida: true\n        };\n      }), catchError(error => {\n        return [{\n          urlInvalida: true\n        }];\n      }));\n    }\n\n  }\n\n  CadastroComponent.ɵfac = function CadastroComponent_Factory(t) {\n    return new (t || CadastroComponent)(i0.ɵɵdirectiveInject(i1.HttpClient), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i3.PageDataService));\n  };\n\n  CadastroComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: CadastroComponent,\n    selectors: [[\"app-cadastro\"]],\n    decls: 30,\n    vars: 12,\n    consts: [[1, \"mdl-layout\", \"mdl-js-layout\", \"mdl-layout--fixed-drawer\", \"mdl-layout--fixed-header\"], [1, \"mdl-layout__content\"], [1, \"page-content\"], [1, \"mdl-grid\"], [3, \"formGroup\", \"ngSubmit\"], [\"class\", \"mdl-textfield is-invalid\", 4, \"ngIf\"], [3, \"campo\"], [\"formControlName\", \"nome\", \"autofocus\", \"\", \"type\", \"text\", \"name\", \"nome\", \"cmailFormField\", \"\"], [4, \"ngIf\"], [\"formControlName\", \"username\", \"type\", \"text\", \"name\", \"username\", \"cmailFormField\", \"\"], [1, \"mdl-textfield__error\"], [\"formControlName\", \"senha\", \"type\", \"password\", \"name\", \"senha\", \"cmailFormField\", \"\"], [\"formControlName\", \"telefone\", \"type\", \"text\", \"name\", \"telefone\", \"cmailFormField\", \"\"], [\"formControlName\", \"avatar\", \"type\", \"text\", \"name\", \"avatar\", \"cmailFormField\", \"\"], [1, \"mdl-card__actions\"], [1, \"mdl-button\", \"mdl-js-button\", \"mdl-button--raised\", \"mdl-button--accent\"], [1, \"mdl-textfield\", \"is-invalid\"], [\"class\", \"mdl-textfield__error\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"mdl-textfield__error\", 4, \"ngIf\"], [3, \"src\"]],\n    template: function CadastroComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵelement(1, \"cmail-header\");\n        i0.ɵɵelementStart(2, \"main\", 1);\n        i0.ɵɵelementStart(3, \"div\", 2);\n        i0.ɵɵelementStart(4, \"div\", 3);\n        i0.ɵɵelementStart(5, \"form\", 4);\n        i0.ɵɵlistener(\"ngSubmit\", function CadastroComponent_Template_form_ngSubmit_5_listener() {\n          return ctx.handleCadastrarUsuario();\n        });\n        i0.ɵɵtemplate(6, CadastroComponent_ul_6_Template, 2, 1, \"ul\", 5);\n        i0.ɵɵelementStart(7, \"cmail-form-group\", 6);\n        i0.ɵɵelement(8, \"input\", 7);\n        i0.ɵɵtemplate(9, CadastroComponent_div_9_Template, 3, 2, \"div\", 8);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(10, \"cmail-form-group\", 6);\n        i0.ɵɵelement(11, \"input\", 9);\n        i0.ɵɵelementStart(12, \"span\", 10);\n        i0.ɵɵtext(13, \"Informar um nome de usu\\u00E1rio \\u00E9 obrigat\\u00F3rio\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(14, \"cmail-form-group\", 6);\n        i0.ɵɵelement(15, \"input\", 11);\n        i0.ɵɵelementStart(16, \"span\", 10);\n        i0.ɵɵtext(17, \"Informar uma senha \\u00E9 obrigat\\u00F3ria\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(18, \"cmail-form-group\", 6);\n        i0.ɵɵelement(19, \"input\", 12);\n        i0.ɵɵtemplate(20, CadastroComponent_div_20_Template, 3, 2, \"div\", 8);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(21, \"cmail-form-group\", 6);\n        i0.ɵɵelement(22, \"input\", 13);\n        i0.ɵɵtemplate(23, CadastroComponent_div_23_Template, 3, 2, \"div\", 8);\n        i0.ɵɵelementStart(24, \"div\");\n        i0.ɵɵtemplate(25, CadastroComponent_span_25_Template, 2, 1, \"span\", 8);\n        i0.ɵɵtemplate(26, CadastroComponent_span_26_Template, 2, 0, \"span\", 8);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(27, \"div\", 14);\n        i0.ɵɵelementStart(28, \"button\", 15);\n        i0.ɵɵtext(29, \" Cadastrar \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"formGroup\", ctx.formCadastro);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.mensagensErro);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"campo\", ctx.formCadastro.get(\"nome\"));\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.formCadastro.get(\"nome\").errors);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"campo\", ctx.formCadastro.get(\"username\"));\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"campo\", ctx.formCadastro.get(\"senha\"));\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"campo\", ctx.formCadastro.get(\"telefone\"));\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.formCadastro.get(\"telefone\").errors);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"campo\", ctx.formCadastro.get(\"avatar\"));\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.formCadastro.get(\"avatar\").errors);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.formCadastro.get(\"avatar\").status === \"VALID\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.formCadastro.get(\"avatar\").status === \"PENDING\");\n      }\n    },\n    directives: [i4.HeaderComponent, i5.ɵNgNoValidate, i5.NgControlStatusGroup, i5.FormGroupDirective, i6.NgIf, i6.NgForOf, i7.CmailFormGroupComponent, i5.DefaultValueAccessor, i5.NgControlStatus, i5.FormControlName, i8.CmailFormFieldDirective],\n    styles: [\"\"]\n  });\n  return CadastroComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}